<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>My Web App Journey - Data Store | My Perspective of the world</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="My Web App Journey - Data Store" />
<meta name="author" content="Jonathan Tweedle" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In the previous chapter my initial plan was to improve the data repository to leverage MongoDB. I ended up deviating from that plan to focus on some SOLID principles." />
<meta property="og:description" content="In the previous chapter my initial plan was to improve the data repository to leverage MongoDB. I ended up deviating from that plan to focus on some SOLID principles." />
<link rel="canonical" href="https://xiltch.github.io/2020/02/29/my-web-app-journey-data-store/" />
<meta property="og:url" content="https://xiltch.github.io/2020/02/29/my-web-app-journey-data-store/" />
<meta property="og:site_name" content="My Perspective of the world" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-29T14:32:01+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="My Web App Journey - Data Store" />
<script type="application/ld+json">
{"description":"In the previous chapter my initial plan was to improve the data repository to leverage MongoDB. I ended up deviating from that plan to focus on some SOLID principles.","headline":"My Web App Journey - Data Store","url":"https://xiltch.github.io/2020/02/29/my-web-app-journey-data-store/","datePublished":"2020-02-29T14:32:01+00:00","dateModified":"2020-02-29T14:32:01+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://xiltch.github.io/2020/02/29/my-web-app-journey-data-store/"},"author":{"@type":"Person","name":"Jonathan Tweedle"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://xiltch.github.io/feed.xml" title="My Perspective of the world" /><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XPPPBC54MV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XPPPBC54MV');
</script></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">My Perspective of the world</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/links/">Links</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">My Web App Journey - Data Store</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-02-29T14:32:01+00:00" itemprop="datePublished">Feb 29, 2020
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Jonathan Tweedle</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In the <a href="/2019/01/27/my-web-journey-data-repository/">previous chapter</a> my initial plan was to improve the data repository to leverage MongoDB. I ended up deviating from that plan to focus on some SOLID principles.</p>

<p>This chapter will be about introducing MongoDB connectivity to  manage the data persistence of the API.</p>

<h2 id="first-steps">First Steps</h2>

<p>I start by opening my project and going to the terminal window. Making sure that I am currently at the root folder of my project, install the MongoDB dependencies to the project.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install MongoDB
</code></pre></div></div>

<p>This downloads the required dependency files, while updating the project configuration file (package.json) as needed.</p>

<h2 id="a-new-world">A new world</h2>

<p>I want to add a new repository that uses a connection to the MongoDB server. The recommended design is to only create a single instance of the client that is reused instead of creating a new connection for every call. Sticking to the SOLID principles I am going to inject this into the repository.</p>

<p>To start I need to define a type that will hold the symbols used for the injection pattern.  This will update the types as follows:</p>

<p><strong>/src/types.ts</strong></p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">REPOSITORY_TYPES</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">Transaction</span><span class="p">:</span> <span class="nb">Symbol</span><span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="dl">'</span><span class="s1">Transactions</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">CONTROLLERS</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">Transaction</span><span class="p">:</span> <span class="nb">Symbol</span><span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="dl">'</span><span class="s1">Transaction</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">SINGLETONS</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">Routing</span><span class="p">:</span> <span class="nb">Symbol</span><span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="dl">'</span><span class="s1">Routing</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">CONNECTIONS</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">MongoDB</span><span class="p">:</span> <span class="nb">Symbol</span><span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="dl">'</span><span class="s1">MongoDB</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="the-wrong-path">The wrong path</h2>

<p>Sometimes we don’t realize some choices are not the right ones. Just as I was about to get my new repository in place, I uncovered a flaw in my interface design.</p>

<p>It is too generic.</p>

<p>I was trying to rely on the freedom to move the ability to filter matches away from the repository by relying on predicates. This conflicted with the MongoDB driver which uses a query language.</p>

<p>I need to update my interface to introduce the various methods by which I want to interact with the data. I decided to add some freedom by using regular expressions to allow multiple matches if needed.</p>

<p><strong>/src/models/transaction.ts</strong></p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">class</span> <span class="nx">Transaction</span> <span class="p">{</span>
  <span class="nl">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">amount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">currency</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">date</span><span class="p">:</span> <span class="nb">Date</span><span class="p">;</span>
  <span class="nl">description</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">source</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">type</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">category</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">TransactionRepository</span> <span class="p">{</span>

  <span class="cm">/** add a new transaction to the repository.
   * @returns transaction. null if it failed to add
   */</span>
  <span class="nx">add</span><span class="p">(</span><span class="nx">record</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">):</span> <span class="nx">Transaction</span><span class="p">;</span>

  <span class="cm">/** updates a transaction in the repository.
   * @returns transaction. null if unsuccessful */</span>
  <span class="nx">update</span><span class="p">(</span><span class="nx">record</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">):</span> <span class="nx">Transaction</span><span class="p">;</span>

  <span class="cm">/** removes a record from the repository.
   * @returns transaction. null if unsuccessful */</span>
  <span class="nx">remove</span><span class="p">(</span><span class="nx">record</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">):</span> <span class="nx">Transaction</span><span class="p">;</span>

  <span class="cm">/** get all the transactions in the repository.
   * @returns array of transaction. null if no records found
   */</span>
  <span class="nx">all</span><span class="p">():</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="cm">/** finds the first matching Transaction in the repository based on its ID. supports regular expression matching.
   * @returns transaction. null if not found
   */</span>
  <span class="nx">getByID</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">Transaction</span><span class="p">;</span>

  <span class="cm">/** find transactions in a category. supports regular expression matching.
   * @returns array of transaction. null if no records found
  */</span>
  <span class="nx">findByCategory</span><span class="p">(</span><span class="nx">category</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="cm">/** find transactions based on the description. supports regular expression matching.
   * @returns array of transaction. null if no records found
  */</span>
  <span class="nx">findByDescription</span><span class="p">(</span><span class="nx">description</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="cm">/** find transactions based on the source. supports regular expression matching.
   * @returns array of transaction. null if no records found
  */</span>
  <span class="nx">findByBySource</span><span class="p">(</span><span class="nx">source</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="cm">/** find transactions based on the type. supports regular expression matching.
   * @returns array of transaction. null if no records found
  */</span>
  <span class="nx">findByType</span><span class="p">(</span><span class="kd">type</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="cm">/** find transactions between two given amounts (inclusive).
   * @returns array of transaction. null if no records found
  */</span>
  <span class="nx">findByAmountBetween</span><span class="p">(</span><span class="nx">lower</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">upper</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="cm">/** find transactions above a given amount (exclusive).
   * @returns array of transaction. null if no records found
  */</span>
  <span class="nx">findByAmountAbove</span><span class="p">(</span><span class="nx">amount</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="cm">/** find transactions below a given amount (exclusive).
   * @returns array of transaction. null if no records found
  */</span>
  <span class="nx">findByAmountBelow</span><span class="p">(</span><span class="nx">amount</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="cm">/** find transactions at a given amount (inclusive).
   * @returns array of transaction. null if no records found
  */</span>
  <span class="nx">findByAmount</span><span class="p">(</span><span class="nx">amount</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="cm">/** find transactions between two given dates (inclusive).
   * @returns array of transaction. null if no records found
  */</span>
 <span class="nx">findByDateBetween</span><span class="p">(</span><span class="nx">lower</span><span class="p">:</span> <span class="nb">Date</span><span class="p">,</span> <span class="nx">upper</span><span class="p">:</span> <span class="nb">Date</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

 <span class="cm">/** find transactions after a given date (exclusive).
  * @returns array of transaction. null if no records found
 */</span>
 <span class="nx">findByDateAfter</span><span class="p">(</span><span class="nx">date</span><span class="p">:</span> <span class="nb">Date</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

 <span class="cm">/** find transactions before a given amounts (exclusive).
  * @returns array of transaction. null if no records found
 */</span>
 <span class="nx">findByAmountBefore</span><span class="p">(</span><span class="nx">date</span><span class="p">:</span> <span class="nb">Date</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>

 <span class="cm">/** find transactions on a given amounts.
  * @returns array of transaction. null if no records found
 */</span>
 <span class="nx">findByDate</span><span class="p">(</span><span class="nx">date</span><span class="p">:</span> <span class="nb">Date</span><span class="p">):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="when-life-happens">When Life Happens</h3>

<p>So half way through this step I got started a new course, moved halfway around the world, and well got completely sidetracked.</p>

<p>In the interim angular has gone from version 7.0.3 up to 9.0. We now have the Raspberry Pi 4 which can is recently fully supported through the latest kernel. NodeJs has gone from version v8.12 up to v12.16.</p>

<p>I tried to startup the project which regrettably did not work, initial analysis is linked to my decision to diverge from comparator parameters with highly generic methods to more specific methods. It turns out I still had some changes to make to update my code to use the new interface I had introduced.</p>

<p>This however introduces a typical dilemma when working on a project over such a long time frame. What if you have updated your local environment which means you will need to first revert your development system to match your project and then make the changes or do you bite the bullet and upgrade your project to bring it to the current version in play?</p>

<p>I plan to follow the latter course and update all the elements of the project to use the latest versions. I will hopefully be able to deal with the fallout when i deploy to my hosting system (when it arrives or i build a new one … OpenFaaS pi cluster maybe?) .</p>

<p>So that will conclude this chapter to move on the <a href="/2020/02/29/my-web-app-journey-doing-an-oil-change/">next chapter</a> which will focus on updating everything.</p>

<h3 id="contributing-research-material">Contributing Research Material</h3>

<p><span style="font-size:12px;"><a href="https://fullstack-developer.academy/sharing-a-mongodb-connection-in-node-js-express/">Piros, Tamas. Sharing a MongoDB connection in NodeJS/Express. Web Article. 13 September 2018.</a></span></p>

<p><span style="font-size:12px;"><a href="https://www.youtube.com/watch?v=rtXpYpZdOzM&amp;feature=youtu.be">Hamedani, Mosh. Repository Pattern with C# and Entity Framework, Done Right. Youtube. 15 October 2015.</a></span></p>


  </div><a class="u-url" href="/2020/02/29/my-web-app-journey-data-store/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">My Perspective of the world</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">My Perspective of the world</li><li><a class="u-email" href="mailto:xiltch@gmail.com">xiltch@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/xiltch"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">xiltch</span></a></li><li><a href="https://www.twitter.com/xiltch"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">xiltch</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>The chronicles of a geek, author of code and connoisseur of fine electronics.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
